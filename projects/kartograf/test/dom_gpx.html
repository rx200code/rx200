<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>dom</title>
<script type="text/javascript">
var dom;//=document.getElementById("dom");

let createElement = (name, ...attr) => {
	let elm = document.createElement(name);
	for(let arr_set of attr)elm.setAttribute(arr_set[0], arr_set[1]);
	return elm;
};
let input_file_gpx = createElement("input", ["type", "file"], ["multiple", ""]);



let parser_gpx = (file, t) => {
	/*
	let obj = {};
	// Ищим декларацию.
	let result = reg_declaration.exec(t);
	if(result !== null)obj.declaration = result[1];
	else obj.declaration = "not";
	alert(file.name+"\n"+obj.declaration);
	alert(f_attr_v(obj.declaration, "version"));
	alert(f_attr_v(obj.declaration, "encoding"));
	alert(f_attr_v(obj.declaration, "standalone"));
	//*/
	//*
	//application/xml вроде предпочтительнее чем text/xml
	let parser = new DOMParser();
	//let xmlDoc = parser.parseFromString(t,"text/xml");
	dom = parser.parseFromString(t,"text/xml");
	alert(file.name);
	//alert(file.name+"\n"+xmlDoc.getElementsByTagName("gpx")[0].attributes.length);
	//alert(file.name+"\n"+xmlDoc.getElementsByTagName("gpx")[0].attributes[0].nodeName+" "+xmlDoc.getElementsByTagName("gpx")[0].attributes[0].value);
	//*/
};

let reg_gpx = /\.gpx$/i;
input_file_gpx.onchange = () => {
	let t_error = "Файлы:";
	for(let i = 0; i < input_file_gpx.files.length; i++){
		// добавить вывод информации о самом файле
		//input_file_gpx.files[i].text().then(parser_gpx, error => {alert(error);});// Вроде не работает в опере.
		// Проверка по фориату(gpx) имени файла.
		if(!reg_gpx.test(input_file_gpx.files[i].name)){
			t_error += input_file_gpx.files[i].name+", ";
			continue;
		}
		let reader = new FileReader();
		reader.onload = () => {
			parser_gpx(input_file_gpx.files[i], reader.result);
		};
		reader.readAsText(input_file_gpx.files[i]);
	}
	t_error += "Непрошли по формату gpx.";
	//alert(t_error);
};
	




window.onload = function(){dom=document.getElementById("dom");};
function fff2(){
  var text="";
  var textObj=document.getElementById("input").value;
  var obj=eval(document.getElementById("input").value);
  text+=""+obj+"<br>";
  for(var i in obj)text+="<span onClick=document.getElementById('input').value=&quot;"+
  textObj+(isFinite(i)?"["+i+"]":"."+i)+"&quot;>"+
  eval(document.getElementById("input2").value)+"</span><br>";
  document.getElementById("output2").innerHTML=text;}
function fff(textObj){
  var text="";
  var obj=eval(textObj);
  text+="<span onClick=fff(\""+(textObj.lastIndexOf("[")<0?textObj:textObj.substring(0,textObj.lastIndexOf("[")))+"\")><b>"+textObj+"</b></span><br>"+obj+"<br>";
  for(var i in obj)text+="<span onClick=fff(\""+textObj+"['"+i+"']\")><b>"+i+
  "</b></span><span  onClick=document.getElementById('input').value=\""+textObj+(isFinite(i)?"["+i+"]":"."+i)+"\"> = "+obj[i]+"</span><br>";
  document.getElementById("output").innerHTML=text;}
</script>
</head>
<body>
<input type="button" value="load" onClick="input_file_gpx.click();">
<div id="dom">123div123</div>
<input type="button" value="button" onClick="fff('dom')">
<span id="output"></span>
<br><input type="button" value="button2" onClick="fff2()">
<input type="text" id="input" size="140" value="">
<input type="button" value="()" onClick="document.getElementById('input').value+='()'"><br>
<input type="button" value="reset" onClick="document.getElementById('input2').value=&quot;i+' = '+obj[i]&quot;">
<input type="text" id="input2" size="140" value="i+' = '+obj[i]">
<br><span id="output2"></span>
</body>
</html>
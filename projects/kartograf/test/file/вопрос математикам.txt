оптимизация нахождения ближайший точки сетки.


Есть прямоугольная сетка, для простоты начало построения и в будующем поворот её находится в начале системы координат.
шаг сетки обозначим step
возьмем произвольную точку с координатами x и y
задача найти ближайшию к ней точку сетки с координатами x_p и y_p.
если сетка не повернута то достаточно просто находим.
остаток от деления offset = x % step;
x_p = x;
if(x > 0 && offset > step / 2)x_p = x_p + step;
if(x < 0 && offset < step / -2)x_p = x_p - step;
x_p = x_p - offset;
аналогично для y_p.
тут возможно можно оптимизировать.

Но главное хотелось бы найти оптимальное решение для нахождения точки если сетка повернута относительно центра.
пока я нахожу так.
1. поворачиваем начальную точку, на угол поворота сетки a.
a_p = atan2(y, x) + a;
r = (x ^ 2 + y ^ 2) ^ .5;
x_a = r * cos(a_p);
y_a = r * sin(a_p);
2. находим ближайшую точку сетки с координатами x_p и y_p. как для неповернутой сетки.
3. поворачиваем найденную точку обратно.
a_p = atan2(y_p, x_p) - a;
r = (x_p ^ 2 + y_p ^ 2) ^ .5;
x_p = r * cos(a_p);
y_p = r * sin(a_p);

Вопрос в том, можно ли както обойтись без поворотов?

Нахождение координат прямоугольной сетки.
для простоты, рассмотрим начало построения сетки в начале координат, и там же поворот. так же все рассматриваем в положительных координатах. чтоб не усложнять, то что, сути всеравно не менияет.
По сути для нахождения координат сетки(не повернутой). близких к любой точки(x,y), мы или отнимаем остаток от деления на шаг(step) сетки, или берем целую часть от деления на шаг сетки и умножаем её на шаг сетки.
в программировании выглядит примерно так:
x - x % step; или int(x / step) * step; аналогично для y.
чтоб найти ближайшую точку сетки к любой точки, нужно еще посмотреть остаток больше половины шага или нет, и в зависимости от этого прибавить шаг. сути это не меняет и писать этого не вижу смысла.

Меня интересует как находить точки сетки, если она повернута на какойто угол "a" в начале координат?
пока приходится поворачивать точку назад на угол "a", потом стандартным способом для неповернутой сетки находить блидайшую точку сетки, и найденную точку обратно поворачивать на угол "a".
Мне кажется в математике должны быть более простые способы.









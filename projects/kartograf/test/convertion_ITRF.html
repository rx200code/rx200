<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<!-- 
Создатель © feb7e9c4d5539ae0f1496cdb2aaee27c
-->
<title>ITRF</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<script type="text/javascript">
// ITRF 2014
//5872 / 2 = 2936 // GNSS
//444 / 2 = 222 // DORIS
//362 / 2 = 181 // SLR
//406 / 2 = 203 // VLBI
let toDeg = rad => rad / Math.PI * 180;
function b(){
	let text = "let arr_p = [";
	let t_in = document.getElementById("t_in").value;
	
	let reg = /^\d{5}[A-Z]\d{3}\s\w.+(GNSS|DORIS|SLR|VLBI)\s([A-Z0-9]{4})\s+(-?\d+\.\d+)\s+(-?\d+\.\d+)\s+(-?\d+\.\d+)\s+/gm;
	let count = 0;
	
	let el = {
		a:6378137,
		_f:298.257222101,
	};
	el.f = 1 / el._f;
	el.b = el.a - el.a * el.f;
	el.e_2 = 2 * el.f - el.f ** 2;
	let f_reg = (match, tech, id, X, Y, Z) => {
		X *= 1;
		Y *= 1;
		Z *= 1;
		let p = (X ** 2 + Y ** 2) ** 0.5;
		let q = Math.atan2(Z * el.a, p * el.b);
		let zt = el.e_2 / (1 - el.e_2);
		let L = Math.atan2(Y, X);
		let B = Math.atan2(Z + zt * el.b * Math.sin(q) ** 3, p - el.e_2 * el.a * Math.cos(q) ** 3);
		if(count > 0)text += ",";
		text += "["+toDeg(B)+","+toDeg(L)+",'"+id+"']";
		count++;
		return "";
	}
	t_in.replace(reg, f_reg);
	text += "];";
	
	out_t(text);
	out(count);
}
function out_t(text){
	document.getElementById("t_out").value=text;
}
function out(text){
	document.getElementById("output").innerHTML=text;
}
</script>
</head>
<body>
<textarea rows="10" cols="100" spellcheck="false" id="t_in"></textarea>
<br>
<input type="button" value="Преобразовать" onClick="b()">
<br>
<textarea rows="10" cols="100" spellcheck="false" id="t_out"></textarea>
<br>
<span id="output"></span>
</body>
</html>